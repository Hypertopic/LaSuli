<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Hypertopic JavaScript Library</title>

		<link type="text/css" href="css/blitzer/jquery-ui-1.8.4.custom.css" rel="stylesheet" />
		<link type="text/css" href="css/lasuli.css" rel="stylesheet" />
		<link type="text/css" href="css/ui.jqgrid.css" rel="stylesheet" />

		<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.8.4.custom.min.js"></script>

		<link type="text/css" href="css/jquery.contextMenu.css" rel="stylesheet" />
		<script type="text/javascript" src="js/jquery.contextMenu.js"></script>
		<script type="text/javascript" src="js/jquery.tinysort.js"></script>
		<script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="js/jquery.jstree.js"></script>

		<script type="text/javascript" src="js/HypertopicMap.js"></script>

		<script type="text/javascript" src="js/jquery.jsonview.js"></script>
    <link type="text/css" rel="stylesheet" href="css/jquery.jsonview.css">

    <style type="text/css" media="screen">
  		body{background:#f5f9f5; overflow:auto; margin-left: 15px;}
  		.jsonview{
  			border:1px solid #787;overflow:auto; width: 80%;
  			-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px;padding:10px;bottom:10%;
  			-moz-box-shadow:3px 3px 6px #ccc;-webkit-box-shadow:3px 3px 6px #ccc;box-shadow:3px 3px 6px #ccc;
  			background:#fff;
  			margin: 0px 5px 5px 5px;
  		}
  	</style>

  	<script language="javascript">

  	  var map, user, corpus, item, highlight, viewpoint, topic, childTopic, otherTopic;

      function test(){
        map = new HtMap('http://127.0.0.1/argos/_design/argos/_rewrite/', '','');
        user = map.getUser("me");
        corpus = user.createCorpus("my corpus");
        item = corpus.createItem("my item");
        item.describe("foo", "bar");
        item.describe("resource", "http://acme.com/foo");
        viewpoint = user.createViewpoint("my viewpoint");
	      topic = viewpoint.createTopic();
	      childTopic = viewpoint.createTopic(topic);
	      otherTopic = viewpoint.createTopic();
	      highlight = item.createHighlight(
		      childTopic, "FOO", new Array(1024, 1096)
	      );
	      item.tag(childTopic);
	      h3("User");
        json(user.getObject());
        h3("Corpus");
        json(corpus.getRaw());
        h3("Item");
	      json(item.getRaw());
	      h3("Viewpoint");
	      json(viewpoint.getRaw());
	      json(viewpoint.getView());
        //return false;

        item.describe("foo", "bar2");

        h3("item.getAttributes()");
        json(item.getAttributes());
        item.undescribe("foo", "bar");
        json(item.getAttributes());

        h3("item.getTopics()");
        json(item.getTopics());

        h3("item.getResource()");
        json(item.getResource());

        h3("Item.getHighlights");
	      json(item.getHighlights());

        h3("topic.getHighlights");
	      json(topic.getHighlights());


	      h3("viewpoint.getHighlights");
	      json(viewpoint.getHighlights());

        var userHim = map.getUser("him");
        corpus.register(userHim);
        h3("Corpus");
        json(corpus.getObject());
        h3("Corpus.listUsers()");
        json(corpus.listUsers());

        corpus.unregister(user);
        json(corpus.listUsers());
        corpus.rename("new name");
        h3("corpus rename");
        json(corpus.getName());

        h3("highlight.getText");
        json(highlight.getText());

        h3("item.getName");
        json(item.getName());

        h3("corpus.getItems()");
        json(corpus.getItems());

        h3("childTopic.getItems()");
        json(viewpoint.getView());
        json(childTopic);
        json(childTopic.getItems());

        h3("viewpoint.getItems()");
        json(viewpoint.getItems());

        item.untag(childTopic);
        h3("Item.untag");
	      json(item.getRaw());



        h3("topic.getName");
        json(topic.getName());

        topic.rename("a topic");
        json(topic.getName());

        h3("topic.getNarrower()");
        json(viewpoint.getRaw());
        json(topic.getNarrower());

        h3("topic.moveTopics");
        json(childTopic);
        json(otherTopic);
        json(viewpoint.getRaw());
        otherTopic.moveTopics(childTopic);
	      var broader = childTopic.getBroader();
	      json(viewpoint.getRaw());
	      json(broader);

        h3("topic.linkTopics");
        json(viewpoint.getRaw());
	      otherTopic.linkTopics(childTopic);
	      var broader = childTopic.getBroader();
	      json(viewpoint.getRaw());
        json(otherTopic);
	      json(broader);

        h3("topic.unlink");
        json(viewpoint.getRaw());
        childTopic.unlink();
	      var broader = childTopic.getBroader();
        json(viewpoint.getRaw());
        json(childTopic);
	      json(broader);

        h3("viewpoint.getUpperTopics()");
        json(viewpoint.getUpperTopics());



        h3("topic.destroy()");
        json(topic.destroy());

        h3("viewpoint.destroy()");
        json(viewpoint.destroy());
        /*h3("htMapUser.createViewpoint('test viewpoint')");
        json(htMapUser.createViewpoint('test viewpoint'));
        h3("htMapUser.listCorpora()");
        json(htMapUser.listCorpora());
        h3("htMapUser.listViewpoints()");
        json(htMapUser.listViewpoints());*/
        $('div.lvl-0').children('ul').children('li').children('dl').children('dt').children('a.property-toggle-button').each(
          function(){
            if(!$(this).parent('property-name').hasClass('closed-string'))
              $(this).click();
          }
        );
      }
      function json(obj)
      {
        var div;
        if(typeof(obj) == "string")
          try{
            obj = JSON.parse(obj);
            div = $('<div class="jsonview"></div>').jsonView(obj);
          }catch(e){
            div = $('<div class="jsonview"></div>').html(obj);
          }
        else
        {
          obj = getObject(obj);
          div = $('<div class="jsonview"></div>').jsonView(obj);
        }
        $('#result').append(div);
      }
      function h3(str)
      {
        var div = $('<h3></h3>').html(str);
        $('#result').append(div);
      }

    </script>
	</head>
<body id="result" onLoad="test();">
<!--<input type="button" onclick="Observers.notify('lasuli.contextmenu.doHide', null);" value="disable"> //-->
</body>
</html>